
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Using asteval &#8212; ASTEVAL: Minimal Python AST evaluator</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="asteval reference" href="api.html" />
    <link rel="prev" title="Motivation for asteval" href="motivation.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="asteval reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="motivation.html" title="Motivation for asteval"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ASTEVAL: Minimal Python AST evaluator</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using asteval</a><ul>
<li><a class="reference internal" href="#creating-and-using-an-asteval-interpreter">creating and using an asteval Interpreter</a></li>
<li><a class="reference internal" href="#accessing-the-symbol-table">accessing the symbol table</a></li>
<li><a class="reference internal" href="#built-in-functions">built-in functions</a></li>
<li><a class="reference internal" href="#conditionals-and-loops">conditionals and loops</a></li>
<li><a class="reference internal" href="#printing">printing</a></li>
<li><a class="reference internal" href="#writing-functions">writing functions</a></li>
<li><a class="reference internal" href="#exceptions">exceptions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="motivation.html"
                        title="previous chapter">Motivation for asteval</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api.html"
                        title="next chapter">asteval reference</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/basics.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-asteval">
<h1>Using asteval<a class="headerlink" href="#using-asteval" title="Permalink to this headline">¶</a></h1>
<p>This chapter gives a quick overview of asteval, showing basic usage and the
most important features.  Further details can be found in the next chapter
(<a class="reference internal" href="api.html#asteval-api"><span class="std std-ref">asteval reference</span></a>).</p>
<div class="section" id="creating-and-using-an-asteval-interpreter">
<h2>creating and using an asteval Interpreter<a class="headerlink" href="#creating-and-using-an-asteval-interpreter" title="Permalink to this headline">¶</a></h2>
<p>The asteval module is very easy to use.  Import the module and create an Interpreter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">asteval</span> <span class="k">import</span> <span class="n">Interpreter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span> <span class="o">=</span> <span class="n">Interpreter</span><span class="p">()</span>
</pre></div>
</div>
<p>and now you have an embedded interpreter for a procedural, mathematical language
that is very much like python:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="p">(</span><span class="s1">&#39;x = sqrt(3)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="p">(</span><span class="s1">&#39;print x&#39;</span><span class="p">)</span>
<span class="go">1.73205080757</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;for i in range(10):</span>
<span class="go">print i, sqrt(i), log(1+1)</span>
<span class="go">&#39;&#39;&#39;)</span>
<span class="go">0 0.0 0.0</span>
<span class="go">1 1.0 0.69314718056</span>
<span class="go">2 1.41421356237 1.09861228867</span>
<span class="go">3 1.73205080757 1.38629436112</span>
<span class="go">4 2.0 1.60943791243</span>
<span class="go">5 2.2360679775 1.79175946923</span>
<span class="go">6 2.44948974278 1.94591014906</span>
<span class="go">7 2.64575131106 2.07944154168</span>
<span class="go">8 2.82842712475 2.19722457734</span>
<span class="go">9 3.0 2.30258509299</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-the-symbol-table">
<h2>accessing the symbol table<a class="headerlink" href="#accessing-the-symbol-table" title="Permalink to this headline">¶</a></h2>
<p>The symbol table (that is, the mapping between variable and function names
and the underlying objects) is a simple dictionary held in the
<code class="xref py py-attr docutils literal"><span class="pre">symtable</span></code> attribute of the interpreter, and can be read or written
to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="p">(</span><span class="s1">&#39;x = sqrt(3)&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="o">.</span><span class="n">symtable</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="go">1.73205080757</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="o">.</span><span class="n">symtable</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="p">(</span><span class="s1">&#39;print y/8&#39;</span><span class="p">)</span>
<span class="go">12.5</span>
</pre></div>
</div>
<p>Note here the use of true division even though the operands are integers.</p>
<p>As with Python itself, valid symbol names must match the basic regular
expression pattern:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">valid_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z_</span><span class="p">][</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="n">_</span><span class="p">]</span><span class="o">*</span>
</pre></div>
</div>
<p>In addition, certain names are reserved in Python, and cannot be used
within the asteval interpreter.  These reserved words are:</p>
<blockquote>
<div>and, as, assert, break, class, continue, def, del, elif, else,
except, exec, finally, for, from, global, if, import, in, is,
lambda, not, or, pass, print, raise, return, try, while, with,
True, False, None, eval, execfile, __import__, __package__</div></blockquote>
</div>
<div class="section" id="built-in-functions">
<h2>built-in functions<a class="headerlink" href="#built-in-functions" title="Permalink to this headline">¶</a></h2>
<p>At startup, many symbols are loaded into the symbol table from
Python’s builtins and the <strong>math</strong> module.   The builtins include
several basic Python functions:</p>
<blockquote>
<div>abs, all, any, bin, bool, bytearray, bytes, chr, complex,
dict, dir, divmod, enumerate, filter, float, format,
frozenset, hash, hex, id, int, isinstance, len, list, map,
max, min, oct, ord, pow, range, repr, reversed, round,
set, slice, sorted, str, sum, tuple, type, zip</div></blockquote>
<p>and a large number of named exceptions:</p>
<blockquote>
<div>ArithmeticError, AssertionError, AttributeError,
BaseException, BufferError, BytesWarning, DeprecationWarning,
EOFError, EnvironmentError, Exception, False,
FloatingPointError, GeneratorExit, IOError, ImportError,
ImportWarning, IndentationError, IndexError, KeyError,
KeyboardInterrupt, LookupError, MemoryError, NameError, None,
NotImplemented, NotImplementedError, OSError, OverflowError,
ReferenceError, RuntimeError, RuntimeWarning, StopIteration,
SyntaxError, SyntaxWarning, SystemError, SystemExit, True,
TypeError, UnboundLocalError, UnicodeDecodeError,
UnicodeEncodeError, UnicodeError, UnicodeTranslateError,
UnicodeWarning, ValueError, Warning, ZeroDivisionError</div></blockquote>
<p>The symbols imported from Python’s <em>math</em> module include:</p>
<blockquote>
<div>acos, acosh, asin, asinh, atan, atan2, atanh, ceil, copysign,
cos, cosh, degrees, e, exp, fabs, factorial, floor, fmod,
frexp, fsum, hypot, isinf, isnan, ldexp, log, log10, log1p,
modf, pi, pow, radians, sin, sinh, sqrt, tan, tanh, trunc</div></blockquote>
<p>If available, a very large number (~400) additional symbols are
imported from <a class="reference external" href="http://docs.scipy.org/doc/numpy">numpy</a>.</p>
</div>
<div class="section" id="conditionals-and-loops">
<h2>conditionals and loops<a class="headerlink" href="#conditionals-and-loops" title="Permalink to this headline">¶</a></h2>
<p>If-then-else blocks, for-loops (including the optional <em>else</em> block) and
while loops (also including optional <em>else</em> block) are supported, and work
exactly as they do in python.  Thus:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="go">sum = 0</span>
<span class="go">for i in range(10):</span>
<span class="go">    sum += i*sqrt(*1.0)</span>
<span class="go">    if i % 4 == 0:</span>
<span class="go">        sum = sum + 1</span>
<span class="go">print &quot;sum = &quot;, sum</span>
<span class="go">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="go">sum =  114.049534067</span>
</pre></div>
</div>
</div>
<div class="section" id="printing">
<h2>printing<a class="headerlink" href="#printing" title="Permalink to this headline">¶</a></h2>
<p>For printing, asteval emulates Python’s native <a class="reference external" href="https://docs.python.org/2/library/functions.html#print" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">print()</span></code></a> function (for
Python 3) and <code class="xref py py-data docutils literal"><span class="pre">print</span></code> statement (for Python 2).  That is, the
behavior mimics the version of Python used.</p>
<p>You can change where output is sent with the <code class="docutils literal"><span class="pre">writer</span></code> argument when
creating the interpreter.  By default, outputs are sent to
<a class="reference external" href="https://docs.python.org/2/library/sys.html#sys.stdout" title="(in Python v2.7)"><code class="xref py py-data docutils literal"><span class="pre">sys.stdout</span></code></a>.</p>
</div>
<div class="section" id="writing-functions">
<h2>writing functions<a class="headerlink" href="#writing-functions" title="Permalink to this headline">¶</a></h2>
<p>User-defined functions can be written and executed, as in python with a
<em>def</em> block, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">asteval</span> <span class="k">import</span> <span class="n">Interpreter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span> <span class="o">=</span> <span class="n">Interpreter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;def func(a, b, norm=1.0):</span>
<span class="gp">... </span><span class="s2">return (a + b)/norm</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span><span class="p">(</span><span class="s2">&quot;func(1, 3, norm=10.0)&quot;</span><span class="p">)</span>
<span class="go">0.4</span>
</pre></div>
</div>
</div>
<div class="section" id="exceptions">
<h2>exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<p>asteval monitors and caches exceptions in the evaluated code.  Brief error
messages are printed (with Python’s print statement or function, and so
using standard output by default), and the full set of exceptions is kept
in the <code class="xref py py-attr docutils literal"><span class="pre">error</span></code> attribute of the <code class="xref py py-class docutils literal"><span class="pre">Interpreter</span></code> instance.  This
<code class="xref py py-attr docutils literal"><span class="pre">error</span></code> attribute is a list of instances of the asteval
<code class="xref py py-class docutils literal"><span class="pre">ExceptionHolder</span></code> class, which is accessed through the
<code class="xref py py-meth docutils literal"><span class="pre">get_error()</span></code> method.  The <code class="xref py py-attr docutils literal"><span class="pre">error</span></code> attribute is reset to an empty
list at the beginning of each <code class="xref py py-meth docutils literal"><span class="pre">eval()</span></code>, so that errors are from only
the most recent <code class="xref py py-meth docutils literal"><span class="pre">eval()</span></code>.</p>
<p>Thus, to handle and re-raise exceptions from your Python code in a simple
REPL loop, you’d want to do something similar to</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">asteval</span> <span class="k">import</span> <span class="n">Interpreter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aeval</span> <span class="o">=</span> <span class="n">Interpreter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">inp_string</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s1">&#39;dsl:&gt;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">result</span> <span class="o">=</span> <span class="n">aeval</span><span class="p">(</span><span class="n">inp_string</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aeval</span><span class="o">.</span><span class="n">error</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">aeval</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">get_error</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="asteval reference"
             >next</a> |</li>
        <li class="right" >
          <a href="motivation.html" title="Motivation for asteval"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ASTEVAL: Minimal Python AST evaluator</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Matthew Newville, The University of Chicago.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>